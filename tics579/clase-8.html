<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.32">

  <meta name="author" content="Alfonso Tobar-Arancibia">
  <title>Clases UAI ‚Äì TICS-579-Deep Learning</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-673c2e7d040da7fd4b9d655d29f657a0.css">
  <link rel="stylesheet" href="../logo.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">TICS-579-Deep Learning</h1>
  <p class="subtitle">Clase 8: Redes Recurrentes</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Alfonso Tobar-Arancibia 
</div>
        <p class="quarto-title-affiliation">
            <a href="mailto:alfonso.tobar.a@edu.uai.cl" class="email">alfonso.tobar.a@edu.uai.cl</a>
          </p>
    </div>
</div>

</section>
<section id="datos-secuenciales" class="slide level2 smaller">
<h2>Datos Secuenciales</h2>
<div class="callout callout-note callout-style-simple">
<div class="callout-body">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-content">
<p>Hasta ahora, hemos asumido que los datos con los que trabajamos son independientes e id√©nticamente distribuidos (i.i.d). Sin embargo, en muchos casos, los datos tienen una estructura secuencial que debe ser considerada al momento de modelarlos. Algunos ejemplos comunes de datos secuenciales incluyen:</p>
</div>
</div>
</div>
<div class="columns">
<div class="column">
<h4 id="time-series-precios-de-acciones-datos-meteorol√≥gicos-etc">Time Series (precios de acciones, datos meteorol√≥gicos, etc)</h4>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-8/timeseries.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img data-src="img/clase-8/timeseries.png" class="quarto-figure quarto-figure-center" style="width:50.0%"></a></p>
</figure>
</div>
<h4 id="audio-grabaciones-de-voz-m√∫sica-etc">Audio (grabaciones de voz, m√∫sica, etc)</h4>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-8/audio.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img data-src="img/clase-8/audio.png" class="quarto-figure quarto-figure-center" style="width:70.0%"></a></p>
</figure>
</div>
</div><div class="column">
<h4 id="texto-oraciones-documentos-etc">Texto (oraciones, documentos, etc)</h4>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-8/text.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img data-src="img/clase-8/text.png" class="quarto-figure quarto-figure-center" style="width:70.0%"></a></p>
</figure>
</div>
<h4 id="genoma-secuencias-de-adn-etc.">Genoma (secuencias de ADN, etc.)</h4>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-8/genom.jpeg" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img data-src="img/clase-8/genom.jpeg" class="quarto-figure quarto-figure-center" style="width:50.0%"></a></p>
</figure>
</div>
</div></div>
</section>
<section id="datos-secuenciales-1" class="slide level2 smaller">
<h2>Datos Secuenciales</h2>
<blockquote>
<p>Tambi√©n pudiesen existir datos ‚Äúmultimodales‚Äù, donde por ejemplo, se combinan secuencias con im√°genes.</p>
</blockquote>
<div class="columns">
<div class="column">
<h4 id="image-time-series">Image Time Series</h4>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-8/image_ts.jpg" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img data-src="img/clase-8/image_ts.jpg" class="quarto-figure quarto-figure-center"></a></p>
</figure>
</div>
</div><div class="column">
<h4 id="video">Video</h4>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-8/video.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img data-src="img/clase-8/video.gif" class="quarto-figure quarto-figure-center"></a></p>
</figure>
</div>
</div></div>
</section>
<section id="c√≥mo-se-ven-datos-secuenciales-reales" class="slide level2 smaller">
<h2>¬øC√≥mo se ven datos secuenciales reales?</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-8/forecast_example.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img data-src="img/clase-8/forecast_example.png" class="quarto-figure quarto-figure-center" style="width:50.0%"></a></p>
</figure>
</div>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Supongamos el siguiente ejemplo:</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Buscamos predecir el porcentaje de retorno de la inversi√≥n en funci√≥n de los retornos obtenidos en d√≠as anteriores.</li>
<li>En este ejemplo, la acci√≥n ‚ÄúAzul‚Äù cuenta con un historial de 10 d√≠as, mientras que la acci√≥n ‚ÄúRoja‚Äù dispone √∫nicamente de 5 d√≠as de historial.</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-warning no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Nos gustar√≠a poder entrenar un modelo capaz de trabajar con datos de entrada de distintas longitudes (secuencias de tama√±o variable).</strong></p>
</div>
<div class="callout-content">

</div>
</div>
</div>
<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Queremos que el modelo sea capaz de utilizar informaci√≥n pasada para realizar predicciones sobre valores futuros.</strong></p>
</div>
<div class="callout-content">

</div>
</div>
</div>
</section>
<section id="redes-neuronales-recurrentes-rnns" class="slide level2 smaller">
<h2>Redes Neuronales Recurrentes (RNNs)</h2>
<dl>
<dt>RNN</dt>
<dd>
Corresponden a un tipo de red neuronal dise√±ada para procesar secuencias de datos manteniendo en memoria los inputs previos. A diferencia de los otros tipos de redes que procesan datos de manera independiente, ac√° existen conexiones c√≠clicas que permiten retener informaci√≥n en el tiempo.
</dd>
</dl>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-8/simple_RNN.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img data-src="img/clase-8/simple_RNN.png" class="quarto-figure quarto-figure-center"></a></p>
</figure>
</div>
</div><div class="column">
<p><span class="math display">\[h_t = f(x_t \cdot W_{ih}^T + b_{ih} + h_{t-1} \cdot W_{hh}^T + b_{hh})\]</span></p>
<div class="callout callout-caution callout-titled callout-style-simple">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>En la implementaci√≥n original <span class="math inline">\(f\)</span> corresponde a la <span class="math inline">\(tanh(\cdot)\)</span>.</strong></p>
</div>
<div class="callout-content">

</div>
</div>
</div>
</div></div>
</section>
<section id="recurrent-neural-networks" class="slide level2 smaller">
<h2>Recurrent Neural Networks</h2>
<div class="columns">
<div class="column">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Pros</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Pueden tomar secuencias de distinto tama√±o (Largo) como predictores de un problema.</li>
<li>Toman como antecedentes los puntos pasados como referencia para las predicciones futuras.</li>
</ul>
</div>
</div>
</div>
</div><div class="column">
<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Cons</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Se van complicando a medida que las secuencias son cada vez m√°s largas.</li>
<li>Vanishing/Exploding Gradients Problem.</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Nomenclatura</strong></p>
</div>
<div class="callout-content">
<ul>
<li>A las salidas de una RNN se les suele llamar Hidden State (<span class="math inline">\(h_t\)</span>) o Estado Oculto. Este representa la memoria de la red en el tiempo <span class="math inline">\(t\)</span>.</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-caution no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>üö® Una RNN tiene dos set de par√°metros: <span class="math inline">\(W_{ih}\)</span> y <span class="math inline">\(b_{ih}\)</span>, los cuales representan la transformaci√≥n entre los valores de entrada y el estado oculto, y <span class="math inline">\(W_{hh}\)</span> y <span class="math inline">\(b_{hh}\)</span> los que representan la transformaci√≥n entre el estado oculto previo y el actual (Feedback Loop).</strong></p>
</div>
<div class="callout-content">

</div>
</div>
</div>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>üëÄ Es importante mencionar que las RNN son aplicadas a la secuencia elemento a elemento.</strong></p>
</div>
<div class="callout-content">

</div>
</div>
</div>
</section>
<section id="implementaci√≥n-b√°sica-de-una-rnn" class="slide level2 smaller">
<h2>Implementaci√≥n B√°sica de una RNN</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a></a>rnn <span class="op">=</span> nn.RNN(input_size<span class="op">=</span><span class="dv">1</span>, hidden_size<span class="op">=</span><span class="dv">2</span>, num_layers<span class="op">=</span><span class="dv">1</span>, batch_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-2"><a></a></span>
<span id="cb1-3"><a></a><span class="kw">def</span> forward_pass_rnn(x):</span>
<span id="cb1-4"><a></a>    N, L, D <span class="op">=</span> x.shape </span>
<span id="cb1-5"><a></a>    h<span class="op">=</span>[<span class="dv">0</span>]</span>
<span id="cb1-6"><a></a>    <span class="cf">for</span> seq_id <span class="kw">in</span> <span class="bu">range</span>(L):</span>
<span id="cb1-7"><a></a>        h.append(torch.tanh(x[:,seq_id,:]<span class="op">*</span>rnn.weight_ih_l0 <span class="op">+</span> rnn.bias_ih_l0 <span class="op">+</span> h[<span class="op">-</span><span class="dv">1</span>]<span class="op">*</span>rnn.weight_hh_l0 <span class="op">+</span> rnn.bias_hh_l0))</span>
<span id="cb1-8"><a></a>    <span class="cf">return</span> h</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><br></p>
<div class="columns">
<div class="column">
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a><span class="co"># Una secuencia de (3,1)</span></span>
<span id="cb2-2"><a></a>x1 <span class="op">=</span> torch.tensor([[[<span class="fl">2.</span>],</span>
<span id="cb2-3"><a></a>                    [<span class="fl">7.</span>],</span>
<span id="cb2-4"><a></a>                    [<span class="fl">6.</span>]]])</span>
<span id="cb2-5"><a></a>forward_pass_rnn(x1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>tensor([[0.4727, 0.1731]],
        [[ 0.9106, -0.9335]],
        [[ 0.7067, -0.9780]])

Shape: (1,3,2)</code></pre>
</div><div class="column">
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a><span class="co"># Una secuencia de (2,1)</span></span>
<span id="cb4-2"><a></a>x2 <span class="op">=</span> torch.tensor([[[<span class="fl">4.</span>],</span>
<span id="cb4-3"><a></a>                    [<span class="fl">6.</span>]]]))</span>
<span id="cb4-4"><a></a>forward_pass_rnn(x2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>tensor([[ 0.6634, -0.4728]]),
        [[ 0.7876, -0.9505]])

Shape: (1,2,2)</code></pre>
</div></div>
<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>üö® B√°sicamente la RNN genera una transformaci√≥n affine por cada time step <span class="math inline">\(t\)</span> agregando informaci√≥n de su <strong><em>memoria pasada</em></strong>. Es decir, cada elemento de la secuencia es transformado y llevado a un n√∫mero de dimensiones igual a <code>hidden_size</code>.</strong></p>
</div>
<div class="callout-content">

</div>
</div>
</div>
</section>
<section id="unrolling-rnn" class="slide level2 smaller">
<h2>Unrolling RNN</h2>
<div class="columns">
<div class="column" style="width:70%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-8/rnn_unroll.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img data-src="img/clase-8/rnn_unroll.png" class="quarto-figure quarto-figure-center"></a></p>
</figure>
</div>
</div><div class="column" style="width:30%;">
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>‚òùÔ∏è Nomenclatura en Pytorch</strong></p>
</div>
<div class="callout-content">
<ul>
<li>El output <span class="math inline">\(y_t\)</span> tiene al mismo valor que <span class="math inline">\(h_t\)</span>. Se utiliza nomenclatura distinta para diferenciar de una salida directa a un valor que ser√° utilizado como input en el siguiente time step.</li>
<li><span class="math inline">\(h_0\)</span> corresponde al hidden state inicial y tiene por defecto un vector de ceros.</li>
<li><span class="math inline">\(W_{ih}\)</span> y <span class="math inline">\(b_{ih}\)</span> son los par√°metros que proyectan la entrada <span class="math inline">\(x_t\)</span> al hidden size. Mientras que <span class="math inline">\(W_{hh}\)</span> y <span class="math inline">\(b_{hh}\)</span> son los par√°metros que proyectan el hidden state previo <span class="math inline">\(h_{t-1}\)</span> al hidden state actual.</li>
</ul>
</div>
</div>
</div>
</div></div>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>üì¢ Unrolling de una RNN</strong></p>
</div>
<div class="callout-content">
<p>El unrolling consiste en representar una RNN como una secuencia virtual de capas conectadas que permite ver la relaci√≥n entre los elementos de cada time step. Es importante notar que los par√°metros se comparten, es decir, cada una de las capas tiene los mismos pesos y bias.</p>
</div>
</div>
</div>
</section>
<section id="vanishingexploding-gradients" class="slide level2 smaller">
<h2>Vanishing/Exploding Gradients</h2>
<div class="callout callout-warning callout-style-simple">
<div class="callout-body">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-content">
<ul>
<li>Entre m√°s larga se la secuencia (m√°s unrolls se realicen), m√°s dif√≠cil es entrenar la red debido a dos posibles problemas: el <code>vanishing gradient problem</code> y el <code>exploding gradient problem</code>.</li>
</ul>
</div>
</div>
</div>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-9/exploding-vanishing_gradient.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img data-src="img/clase-9/exploding-vanishing_gradient.png" class="quarto-figure quarto-figure-center" style="width:60.0%"></a></p>
</figure>
</div>
</div><div class="column">
<p><span class="math display">\[Gradiente = f(Input \times W_2^{N_{Unroll}})\]</span></p>
<ul>
<li><p>Cuando los valores de <span class="math inline">\(W_2\)</span> son muy peque√±os (menores que 1), el gradiente tiende a desvanecerse (vanishing gradient).</p></li>
<li><p>En cambio, si los valores de <span class="math inline">\(W_2\)</span> son muy grandes (mayores que 1), el gradiente tiende a explotar (exploding gradient).</p></li>
</ul>
<div class="callout callout-caution callout-style-simple">
<div class="callout-body">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-content">
<p>$W_2^{N_unroll} aparece en la ecuaci√≥n al momento de comenzar a derivar de manera recursiva.</p>
</div>
</div>
</div>
<div class="callout callout-important callout-style-simple">
<div class="callout-body">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-content">
<p>Las <code>Vanilla RNNs</code> se utilizan muy poco en la pr√°ctica; sin embargo, tienen una relevancia hist√≥rica significativa, ya que sentaron las bases para el desarrollo de arquitecturas m√°s avanzadas, como las LSTMs y los Transformers.</p>
</div>
</div>
</div>
</div></div>
</section>
<section id="tipos-de-tareas-a-resolver-en-datos-secuenciales" class="slide level2 smaller">
<h2>Tipos de Tareas a Resolver en Datos Secuenciales</h2>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-8/sequence_modeling.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img data-src="img/clase-8/sequence_modeling.png" class="quarto-figure quarto-figure-center"></a></p>
</figure>
</div>
</div><div class="column">
<div class="callout callout-caution no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>üîî Dependiendo de la Tarea de Inter√©s esta se puede clasificar dependiendo de la cantidad de Inputs y la Cantidad de Output.</strong></p>
</div>
<div class="callout-content">

</div>
</div>
</div>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>One to Many</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Generaci√≥n de Texto</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-warning no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Many to One</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Sentiment Analysis</li>
<li>Time Series Forecasting</li>
<li>Time Series Classification</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Many to Many</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Part of Speech Tagging</li>
<li>Machine Translation</li>
</ul>
</div>
</div>
</div>
</div></div>
</section>
<section id="algunos-ejemplos-de-arquitecturas" class="slide level2 smaller">
<h2>Algunos Ejemplos de Arquitecturas</h2>
<div class="columns">
<div class="column">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>‚ú®‚ú® <strong><em>Part of Speech Tagging</em></strong>: Entrego una Secuencia de Largo L y obtengo una Secuencia de Largo L con Clases Asociadas.</strong></p>
</div>
<div class="callout-content">

</div>
</div>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a><span class="kw">class</span> POSTaggingRNN(nn.Module):</span>
<span id="cb6-2"><a></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_size, hidden_size, output_size):</span>
<span id="cb6-3"><a></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb6-4"><a></a>        <span class="va">self</span>.rnn <span class="op">=</span> nn.RNN(</span>
<span id="cb6-5"><a></a>            input_size<span class="op">=</span>input_size,</span>
<span id="cb6-6"><a></a>            hidden_size<span class="op">=</span>hidden_size,</span>
<span id="cb6-7"><a></a>            num_layers<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb6-8"><a></a>            batch_first<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb6-9"><a></a>        )</span>
<span id="cb6-10"><a></a>        <span class="va">self</span>.fc <span class="op">=</span> nn.Linear(hidden_size, output_size)</span>
<span id="cb6-11"><a></a></span>
<span id="cb6-12"><a></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb6-13"><a></a>        rnn_out, hn <span class="op">=</span> <span class="va">self</span>.rnn(x)</span>
<span id="cb6-14"><a></a>        <span class="bu">print</span>(<span class="st">"Tama√±o del Output de RNN: "</span>, hn.shape)</span>
<span id="cb6-15"><a></a>        logits <span class="op">=</span> <span class="va">self</span>.fc(rnn_out)</span>
<span id="cb6-16"><a></a>        <span class="cf">return</span> logits</span>
<span id="cb6-17"><a></a></span>
<span id="cb6-18"><a></a></span>
<span id="cb6-19"><a></a>model <span class="op">=</span> POSTaggingRNN(input_size<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb6-20"><a></a>                    hidden_size<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb6-21"><a></a>                    output_size<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb6-22"><a></a>output <span class="op">=</span> model(x1)</span>
<span id="cb6-23"><a></a><span class="bu">print</span>(<span class="st">"Shape del Output Final: "</span>, output.shape)</span>
<span id="cb6-24"><a></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Tama√±o del Output de RNN:  torch.Size([1, 1, 4])
Shape del Output Final:  torch.Size([1, 3, 3])
tensor([[[-0.6526,  0.2722,  0.2755],
         [-1.1120,  0.7727,  0.4798],
         [-1.0416,  0.7447,  0.4793]]])</code></pre>
</div><div class="column">
<div class="callout callout-caution no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>‚ú®‚ú® <strong><em>Sentiment Analysis</em></strong>: Entrego una Secuencia de Largo L y obtengo una Clase Final (Positiva, Negativa, Neutra).</strong></p>
</div>
<div class="callout-content">

</div>
</div>
</div>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a><span class="kw">class</span> SentimentAnalysisRNN(nn.Module):</span>
<span id="cb8-2"><a></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, input_size, hidden_size, output_size):</span>
<span id="cb8-3"><a></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb8-4"><a></a>        <span class="va">self</span>.rnn <span class="op">=</span> nn.RNN(</span>
<span id="cb8-5"><a></a>            input_size<span class="op">=</span>input_size,</span>
<span id="cb8-6"><a></a>            hidden_size<span class="op">=</span>hidden_size,</span>
<span id="cb8-7"><a></a>            num_layers<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb8-8"><a></a>            batch_first<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb8-9"><a></a>        )</span>
<span id="cb8-10"><a></a>        <span class="va">self</span>.fc <span class="op">=</span> nn.Linear(hidden_size, output_size)</span>
<span id="cb8-11"><a></a></span>
<span id="cb8-12"><a></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb8-13"><a></a>        rnn_out, hn <span class="op">=</span> <span class="va">self</span>.rnn(x)</span>
<span id="cb8-14"><a></a>        <span class="bu">print</span>(<span class="st">"Tama√±o del Hidden State del RNN: "</span>, hn.shape)</span>
<span id="cb8-15"><a></a>        logits <span class="op">=</span> <span class="va">self</span>.fc(hn)</span>
<span id="cb8-16"><a></a>        <span class="cf">return</span> logits</span>
<span id="cb8-17"><a></a></span>
<span id="cb8-18"><a></a></span>
<span id="cb8-19"><a></a>model <span class="op">=</span> SentimentAnalysisRNN(input_size<span class="op">=</span><span class="dv">1</span>, </span>
<span id="cb8-20"><a></a>                            hidden_size<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb8-21"><a></a>                            output_size<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb8-22"><a></a>output <span class="op">=</span> torch.softmax(model(x1), dim<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb8-23"><a></a><span class="bu">print</span>(<span class="st">"Shape del Output Final: "</span>, output.shape)</span>
<span id="cb8-24"><a></a>output</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>Tama√±o del Hidden State del RNN:  torch.Size([1, 1, 4])
Shape del Output Final:  torch.Size([1, 1, 3])
tensor([[[0.0866, 0.5169, 0.3965]]])</code></pre>
</div></div>
</section>
<section id="stacking-rnns" class="slide level2 smaller">
<h2>Stacking RNNs</h2>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-8/stacking_rnn.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img data-src="img/clase-8/stacking_rnn.png" class="quarto-figure quarto-figure-center"></a></p>
</figure>
</div>
</div><div class="column">
<div class="callout callout-tip callout-style-simple">
<div class="callout-body">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-content">
<p>Es posible juntar varias capas recurrentes, para que las salidas de una alimenten un siguiente Hidden State, y que luego de algunas capas efectivamente se llegue a las salidas de inter√©s.</p>
<p>Debido a que hacer esto es complicado esto viene integrado en la implementaci√≥n en Pytorch mediante el par√°metro <code>num_layers</code>.</p>
</div>
</div>
</div>
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>OJO</strong></p>
</div>
<div class="callout-content">
<p>No existen salidas intermedias, sino que los Hidden States de capas anteriores son utilizados directamente como inputs de los hidden states posteriores.</p>
<p>En Pytorch los Hidden States se devuelven concatenados. Es com√∫n utilizar el √∫ltimo Hidden State, es decir, la √∫ltima salida de la √∫ltima capa como Input Features para una capa Fully Connected.</p>
</div>
</div>
</div>
<div class="callout callout-caution callout-style-simple">
<div class="callout-body">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-content">
<p>A diferencia de otro tipos de Redes como las Convolucionales o FFN, la profundidad en este tipo de redes es de bastante menos impacto.</p>
</div>
</div>
</div>
</div></div>
</section>
<section id="variantes-de-rnns-lstm-1997" class="slide level2 smaller">
<h2>Variantes de RNNs: LSTM (1997)</h2>
<dl>
<dt>LSTM (Long Short-Term Memory)</dt>
<dd>
Es un tipo de Red Neuronal Recurrente que est√° dise√±ada para capturar dependencias de largo plazo abordando algunas de las limitaciones de las RNNs tradicionales, tales como el <code>vanishing gradient problem</code>.
</dd>
</dl>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-8/LSTM.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img data-src="img/clase-8/LSTM.png" class="quarto-figure quarto-figure-center"></a></p>
</figure>
</div>
</div><div class="column">
<div class="callout callout-tip callout-style-simple">
<div class="callout-body">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-content">
<p>Posee un funcionamiento similar a la RNN, s√≥lo que el ‚Äúhidden state‚Äù se divide en dos partes: <span class="math inline">\(h_t\)</span> y <span class="math inline">\(C_t\)</span>, llamados <code>hidden state</code> (corto plazo) y <code>cell state</code> (largo plazo) respectivamente.</p>
</div>
</div>
</div>
</div></div>
<div class="callout callout-warning callout-style-simple">
<div class="callout-body">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-content">
<p><strong>Spoiler</strong>: El Hidden y Cell State est√° compuesto por multiples set de par√°metros a los cuales se les dan los nombres de <code>forget gate</code>, <code>input gate</code>, <code>cell gate</code> y <code>output gate</code>. Su interpretabilidad nunca ha logrado ser completamente explicada.</p>
</div>
</div>
</div>
</section>
<section id="variantes-de-rnns-lstm-1997-1" class="slide level2 smaller">
<h2>Variantes de RNNs: LSTM (1997)</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-9/LSTM.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img data-src="img/clase-9/LSTM.png" class="quarto-figure quarto-figure-center"></a></p>
</figure>
</div>
<div class="columns">
<div class="column" style="font-size: 80%;">
<ul>
<li><p>La LSTM est√° regida por las siguientes ecuaciones:</p></li>
<li><p><span class="math display">\[i_t = \sigma(W_{ii}x_t + b_{ii} + W_{hi}h_{t-1} + b_{hi})\]</span></p></li>
<li><p><span class="math display">\[f_t = \sigma(W_{if}x_t + b_{if} + W_{hf}h_{t-1} + b_{hf})\]</span></p></li>
<li><p><span class="math display">\[g_t = tanh(W_{ig}x_t + b_{ig} + W_{hg}h_{t-1} + b_{hg})\]</span></p></li>
<li><p><span class="math display">\[o_t = \sigma(W_{io}x_t + b_{io} + W_{ho}h_{t-1} + b_{ho})\]</span></p></li>
<li><p><span class="math display">\[c_t = f_t \odot c_{t-1} + i_t \odot g_t\]</span></p></li>
<li><p><span class="math display">\[h_t = o_t \odot tanh(c_t)\]</span></p></li>
</ul>
</div><div class="column">
<div class="callout callout-important callout-style-simple">
<div class="callout-body">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-content">
<p>Todas estos elementos <span class="math inline">\(i_t,f_t, g_t,o_t, c_t,h_t \in \mathbb{R}^d\)</span>, donde <span class="math inline">\(d\)</span> es el ‚Äúhidden_size‚Äù.</p>
</div>
</div>
</div>
</div></div>
</section>
<section id="lstm-forget-gate" class="slide level2">
<h2>LSTM: Forget Gate</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-9/forget_gate.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img data-src="img/clase-9/forget_gate.png" class="quarto-figure quarto-figure-center" style="width:40.0%"></a></p>
</figure>
</div>
<div style="font-size: 85%;">
<div class="callout callout-caution no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Forget Gate</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Corresponde a una red neuronal que indica qu√© informacion debe ser descartada del <code>Cell State</code>.</li>
<li>B√°sicamente combina la secuencia en el tiempo t y el hidden state anterior.</li>
<li>Luego se le aplica una Sigmoide que indicar√° el <code>porcentaje</code> a olvidar.</li>
</ul>
<p><span class="math display">\[f_t = \sigma(W_{if}x_t + b_{if} + W_{hf}h_{t-1} + b_{hf})\]</span></p>
</div>
</div>
</div>
</div>
</section>
<section id="lstm-input-y-cell-gate" class="slide level2">
<h2>LSTM: Input y Cell Gate</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-9/input_gate.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img data-src="img/clase-9/input_gate.png" class="quarto-figure quarto-figure-center" style="width:30.0%"></a></p>
</figure>
</div>
<div style="font-size: 70%;">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Input Gate</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Controla Cu√°nta informaci√≥n debe ingresar al <code>Cell State</code>.</li>
</ul>
<p><span class="math display">\[i_t = \sigma(W_{ii}x_t + b_{ii} + W_{hi}h_{t-1} + b_{hi})\]</span></p>
</div>
</div>
</div>
</div>
<div style="font-size: 70%">
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Cell Gate</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Representa los potenciales nuevos candidatos a entrar al <code>Cell State</code>.</li>
</ul>
<p><span class="math display">\[g_t = tanh(W_{ig}x_t + b_{ig} + W_{hg}h_{t-1} + b_{hg})\]</span></p>
</div>
</div>
</div>
</div>
</section>
<section id="output-gate-y-hidden-state" class="slide level2">
<h2>Output Gate y Hidden State</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-9/output_gate.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img data-src="img/clase-9/output_gate.png" class="quarto-figure quarto-figure-center" style="width:30.0%"></a></p>
</figure>
</div>
<div style="font-size: 70%;">
<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Output Gate</strong></p>
</div>
<div class="callout-content">
<ul>
<li><p>Determina qu√© ‚Äúporcentaje‚Äù de informaci√≥n del ‚ÄúCell State‚Äù debe salir como ‚ÄúHidden State‚Äù para el tiempo <span class="math inline">\(t\)</span> actual.</p></li>
<li><p><span class="math display">\[o_t = \sigma(W_{io}x_t + b_{io} + W_{ho}h_{t-1} + b_{ho})\]</span></p></li>
</ul>
</div>
</div>
</div>
</div>
<div style="font-size: 70%;">
<div class="callout callout-warning no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Hidden State</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Corresponde a las dependencias del tiempo anterior que se van traspasando en cada time step.</li>
<li>Adicionalmente el Hidden State corresponde a la salida de la red para el tiempo <span class="math inline">\(t\)</span>.</li>
</ul>
<p><span class="math display">\[h_t = o_t \odot tanh(c_t)\]</span></p>
</div>
</div>
</div>
</div>
</section>
<section id="cell-state" class="slide level2">
<h2>Cell State</h2>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-9/cell_state.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img data-src="img/clase-9/cell_state.png" class="quarto-figure quarto-figure-center" style="width:40.0%"></a></p>
</figure>
</div>
<div style="font-size: 90%;">
<div class="callout callout-none no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Cell State</strong></p>
</div>
<div class="callout-content">
<p>Representa la principal innovaci√≥n de este tipo de redes ya que permite recordar dependencias de largo plazo (es decir time steps anteriores en secuencias largas). Esto ya que el Cell State puede avanzar casi sin interacciones lineales (no hay par√°metros que influyen en ella, por lo que no es afectada por problemas de gradientes).</p>
<p><span class="math display">\[c_t = f_t \odot c_{t-1} + i_t \odot g_t\]</span></p>
</div>
</div>
</div>
</div>
</section>
<section id="variantes-de-rnns-gru-2014" class="slide level2 smaller">
<h2>Variantes de RNNs: GRU (2014)</h2>
<dl>
<dt>GRU (Gated Recurrent Unit)</dt>
<dd>
Corresponde a otro tipo de Arquitectura Recurrente, similar a la LSTM, pero con una estructura m√°s simplificada en la cu√°l se mantiene s√≥lo un ‚ÄúHidden State‚Äù y se tienen menos gates.
</dd>
</dl>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-9/GRU.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img data-src="img/clase-9/GRU.png" class="quarto-figure quarto-figure-center" style="width:80.0%"></a></p>
</figure>
</div>
<div class="callout callout-caution no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Hidden State</strong></p>
</div>
<div class="callout-content">
<p>Representa la potencial actualizaci√≥n del ‚ÄúHidden State‚Äù.</p>
<p><span class="math display">\[h_t = (1-z_t) \odot n_t + z_t \odot h_{t-1}\]</span></p>
</div>
</div>
</div>
</div><div class="column">
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Update Gate</strong></p>
</div>
<div class="callout-content">
<p>Controla qu√© porcentaje del ‚Äúhidden state‚Äù previo se lleva al siguiente paso.</p>
<p><span class="math display">\[z_t = \sigma(W_{iz} x_t + b_{iz} + W_{hz}h_{t-1} + b_{hz})\]</span></p>
</div>
</div>
</div>
<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Reset Gate</strong></p>
</div>
<div class="callout-content">
<p>Controla cu√°nta informaci√≥n del pasado se debe olvidar.</p>
<p><span class="math display">\[r_t = \sigma(W_{ir} x_t + b_{ir} + W_{hr}h_{t-1} + b_{hr})\]</span></p>
</div>
</div>
</div>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Candidate Hidden State</strong></p>
</div>
<div class="callout-content">
<p>Representa la potencial actualizaci√≥n del ‚ÄúHidden State‚Äù.</p>
<p><span class="math display">\[n_t = tanh(W_{in} x_t + b_{in} + r_t \odot (W_{hn} h_{t-1} + b_{hn}))\]</span></p>
</div>
</div>
</div>
</div></div>
</section>
<section id="bidirectional-rnns" class="slide level2 smaller">
<h2>Bidirectional RNNs</h2>
<p>Existen ocasiones en las que se requiere no s√≥lo el contexto de los tiempos anteriores, sino tambi√©n de los posteriores. Por ejemplo, problemas de traducci√≥n.</p>
<blockquote>
<p>Para ello existen las redes bidireccionales, en la cual se agrega una segunda capa pero que mueve los hidden state en el otro sentido.</p>
</blockquote>
<div class="columns">
<div class="column">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><a href="img/clase-9/bidirectional.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img data-src="img/clase-9/bidirectional.png" class="quarto-figure quarto-figure-center" style="width:80.0%"></a></p>
</figure>
</div>
</div><div class="column">
<div class="callout callout-note callout-style-simple">
<div class="callout-body">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-content">
<ul>
<li>En este caso la capa amarilla ser√° la encargada de detectar dependencias del pasado.</li>
<li>Mientras que la capa verde ser√° la encargada de traer dependencias desde el futuro.</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-important callout-style-simple">
<div class="callout-body">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-content">
<p>Los hidden states pueden ser capas Vanilla RNN, LSTM o GRUs.</p>
</div>
</div>
</div>
</div></div>
</section>
<section id="pytorch-layers" class="slide level2">
<h2>Pytorch Layers</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a>nn.RNN(input_size, hidden_size, num_layers<span class="op">=</span><span class="dv">1</span>, batch_first<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb10-2"><a></a>        dropout<span class="op">=</span><span class="dv">0</span>, bidirectional<span class="op">=</span><span class="va">False</span>, nonlinearity<span class="op">=</span><span class="st">"tanh"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a>nn.LSTM(input_size, hidden_size, num_layers<span class="op">=</span><span class="dv">1</span>, batch_first<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb11-2"><a></a>        dropout<span class="op">=</span><span class="dv">0</span>, bidirectional<span class="op">=</span><span class="va">False</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a>nn.GRU(input_size, hidden_size, num_layers<span class="op">=</span><span class="dv">1</span>, batch_first<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb12-2"><a></a>        dropout<span class="op">=</span><span class="dv">0</span>, bidirectional<span class="op">=</span><span class="va">False</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div style="font-size: 60%;">
<ul>
<li><strong>input_size</strong>: Corresponde al n√∫mero de features de la secuencia.</li>
<li><strong>hidden_size</strong>: Corresponde al n√∫mero de dimensiones del hidden state.</li>
<li><strong>num_layers</strong>: Corresponder√° al n√∫mero de capas recurrentes a apilar, por defecto 1.</li>
<li><strong>batch_first</strong>: Este siempre deben fijarlo como True, de esa manera se espera que los tensores a recibir siempre tengan el batch como primera dimensi√≥n. Por defecto False.
<ul>
<li>Luego RNNs esperan tensores de tama√±o <span class="math inline">\((N,L,H_{in})\)</span>. Donde <span class="math inline">\(N\)</span> es el batch_size, <span class="math inline">\(L\)</span> es el largo de secuencia y <span class="math inline">\(H_in\)</span> es el <code>input_size</code>.</li>
</ul></li>
<li><strong>dropout</strong>: Cantidad de dropout a aplicar a la salida de cada capa, excepto la √∫ltima. Por defecto 0.</li>
<li><strong>bidirectional</strong>: Indica si se hace la red Bidireccional o no. Por defecto <code>False</code>.</li>
<li><strong>nonlinearity</strong>: Funci√≥n de activaci√≥n a utilizar para activar cada matriz de peso. Puede ser <strong><em>‚Äútanh‚Äù</em></strong> o <strong><em>‚Äúrelu‚Äù</em></strong>. S√≥lo para Vanilla RNN.</li>
</ul>
</div>
</section>
<section id="eso-ser√≠a-por-hoy" class="title-slide slide level1 center">
<h1>Eso ser√≠a por hoy üòä</h1>
<div class="footer">
<p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/">
</p><p><span property="dct:title">Tics-579 Deep Learning</span> por Alfonso Tobar-Arancibia est√° licenciado bajo <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-SA 4.0</a></p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a>
<p></p>
</div>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../logo-uai-blanco.jpeg" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': false,
'previewLinksAuto': false,
'pdfSeparateFragments': true,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'fast',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1366,

        height: 768,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/datacubeR\.github\.io\/clases_UAI\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    <script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
    (function() {
      let previousOnload = window.onload;
      window.onload = () => {
        if (previousOnload) {
          previousOnload();
        }
        lightboxQuarto.on('slide_before_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          const href = trigger.getAttribute('href');
          if (href !== null) {
            const imgEl = window.document.querySelector(`a[href="${href}"] img`);
            if (imgEl !== null) {
              const srcAttr = imgEl.getAttribute("src");
              if (srcAttr && srcAttr.startsWith("data:")) {
                slideConfig.href = srcAttr;
              }
            }
          } 
        });
      
        lightboxQuarto.on('slide_after_load', (data) => {
          const { slideIndex, slideNode, slideConfig, player, trigger } = data;
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(slideNode);
          }
        });
      
      };
      
    })();
              </script>
    

</body></html>